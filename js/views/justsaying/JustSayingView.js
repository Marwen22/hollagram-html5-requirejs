define(["jquery","underscore","backbone","stackmob","models/shout/ShoutModel","models/whisper/WhisperModel","text!templates/home/homeTemplate.html","text!templates/justsaying/justSayingTemplate.html","router","libs/app/util"],function(e,t,n,r,i,s,o,u,a,f){var l=n.View.extend({className:"justsaying",events:{"click #addBtn":"save","click .logout":"logout"},initialize:function(){this.collection=this.options.collection,this.whisperCollection=this.options.whisperCollection,this.router=this.options.router,this.username=this.options.username,this.template=t.template(u),this.on("render",this.render(),this)},render:function(){var t=this.$el;template=this.template,username=this.username,t.empty(),t.append(o),t.attr("id","justSayingView");var n=t.find(":jqmData(role='content')");return n.append(template()),username!==undefined&&e("input.username").val(username),this},save:function(t){var n=this.collection,r=this.whisperCollection,o=f("#addForm").serializeObject();t.preventDefault();var u=StackMob.isLoggedIn();if(!u)this.router.navigate("#login",{trigger:!0});else if(o.description==="")console.log("error no description"),e.mobile.loading("hide");else{e("#addBtn").attr("disabled",!0);if(o.username===""){var a="Shouting it out";o.user=StackMob.getLoggedInUser();var l=new i(o);l.create({success:function(t){e.mobile.loading("hide"),e("#addBtn").attr("disabled",!1),e("input.description").val(""),e("input.url").val(""),e("input.username").val("");var r=StackMob.LoggedInUserObject;if(r===undefined){var i=new StackMob.User({username:StackMob.getLoggedInUser()});i.fetch({async:!1}),r=i.toJSON()}t.set("user",r),n.add(t)},error:function(t){console.log(t),e.mobile.loading("hide"),e("#addBtn").attr("disabled",!1)}})}else{var a="Whispering softly!",c=new s(o);o.user=StackMob.getLoggedInUser(),c.create({success:function(t){var n=StackMob.LoggedInUserObject;if(n===undefined){var i=new StackMob.User({username:StackMob.getLoggedInUser()});i.fetch({async:!1}),n=i.toJSON()}var i=new StackMob.User({username:o.username});i.fetch({async:!1}),t.set("user",[i.toJSON(),n]),r.add(t),t.appendAndSave("user",[StackMob.getLoggedInUser(),o.username],{success:function(){e.mobile.loading("hide"),e("#addBtn").attr("disabled",!1),e("input.description").val(""),e("input.url").val(""),e("input.username").val(""),e("#whisperListView").listview("refresh"),e("#whisperView").trigger("create")},error:function(t){console.log(t),e("#addBtn").attr("disabled",!1),e.mobile.loading("hide")}})}})}e.mobile.loading("show",{text:a,textVisible:!0,theme:"b"})}return this},logout:function(e){return f(this.$el).setLoginLogoutButton(this.$el,"justsaying"),this}});return l});